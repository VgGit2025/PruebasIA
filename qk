VCH:
LOAD
	*
	,If(OrdenEtapas = 0, OperaciónDesistida_Termino,
	  If(OrdenEtapas = 1, SolicituddeCrédito_Inicio,
	   If(OrdenEtapas = 2, ComitédeCrédito_Inicio,
		If(OrdenEtapas = 3, ProvisióndefondosparaGastosoperacionales_Inicio,
		 If(OrdenEtapas = 4, AsistentedeNegociosenviaOperacionaCurse_Inicio,
		  If(OrdenEtapas = 5, Traspasosupervisorasistentegestión_Inicio,
		   If(OrdenEtapas = 6, Tasación_Inicio,
			If(OrdenEtapas = 7, EstudiodeTítulo_Inicio,
			 If(OrdenEtapas = 8, CálculodeCrédito_Inicio,
			  If(OrdenEtapas = 9, VisadoComercial_Inicio,
			   If(OrdenEtapas = 10, ControldeCrédito_Inicio,
				If(OrdenEtapas = 11, EnvíaaAbogadoInformate_Inicio,
				 If(OrdenEtapas = 12, BorradordeEscritura_Inicio,
				  If(OrdenEtapas = 13, ConfeccióndeMatrizdeescritura_Inicio,
				   If(OrdenEtapas = 14, FirmadelComprador_Inicio,
				    If(OrdenEtapas = 15, ControldeCréditoContabilizar_Inicio,
					 If(OrdenEtapas = 16, Contabilización_Inicio,
					  If(OrdenEtapas = 17, FirmadelVendedor_Inicio,
					   If(OrdenEtapas = 18, InformadeFirmadePartes_Inicio,
						If(OrdenEtapas = 19, TramitaciónCartadeResguardo_Inicio,
						 If(OrdenEtapas = 20, Revisióndeabogado_Inicio,
						  If(OrdenEtapas = 21, CierredeCopias_Inicio,
						   If(OrdenEtapas = 23, InscripciónenCBR_Inicio, 
							If(OrdenEtapas = 24, Finiquito_Inicio,
							 If(OrdenEtapas = 25, VentadeLetras_Inicio,
							  If(OrdenEtapas = 26, Pago_Inicio,Null())))))))))))))))))))))))))) as FechaUltimoEventoVCH;
LOAD
	*
	,if(TipoCarpeta='Asociada',DiasCurseFirmaHabiles,DiasCursePagoHabiles) as DiasCurseHitoFabricaHabil
	,if(TipoCarpeta='Asociada', DiasCurseFirmaCorridos, DiasCursePago) as DiasCurseHitoFabricaCorri
	,if(TipoCarpeta='Asociada', DiasCurseFirmaCorridos, DiasCursePago) as CurseHitoFabrica
	,if(TipoCarpeta='Asociada',DiasCreaciónFirmaHabiles,DiasCreaciónPagoHabiles) as DiasCreacionHitoFabricaHabil
	,if(TipoCarpeta='Asociada', DiasCreacionFirmaCorridos, DiasCorridosCreacionPago) as DiasCreaciónHitoFabricaCorri
	,if(TipoCarpeta='Asociada', DiasCreacionFirmaCorridos, DiasCorridosCreacionPago) as CreaciónHitoFabrica;
LOAD
	*
	,ApplyMap('Map_EstandarComercial', CodigosEstandar, 'Sin Estandar') as EstandarComercial
	,ApplyMap('Map_EstandarFabrica', CodigosEstandar, 'Sin Estandar') as EstandarFábrica
	,ApplyMap('Map_EstandarTotal', CodigosEstandar, 'Sin Estandar') as EstandarTotal
	,ApplyMap('Map_CondicionEstandar', CodigosEstandar, 'Sin Estandar') as EstandarGlosa
	,ApplyMap('Map_CondicionEstandar2', CodigosEstandar, 'Sin Estandar') as EstandarGlosa2
	,ApplyMap('Map_CondicionEstandar3', CodigosEstandar, 'Sin Estandar') as EstandarGlosa3
	,NetWorkDays(FechaCreacion, FechaReingreso, $(vFeriados)) as DiasCreaciónCurseHabiles
	,NetWorkDays(FechaReingreso, FirmadelComprador_Inicio, $(vFeriados)) as DiasCurseFirmaHabiles
	,NetWorkDays(FechaReingreso, FechaDesembolso,  $(vFeriados)) as DiasCursePagoHabiles
	,NetWorkDays(FechaCreacion, FirmadelComprador_Inicio, $(vFeriados)) as DiasCreaciónFirmaHabiles
	,NetWorkDays(FechaCreacion, FechaDesembolso, $(vFeriados)) as DiasCreaciónPagoHabiles
	,NetWorkDays(Contabilización_Termino, today(), $(vFeriados)) as DiasContabilizaciónALaFecha
	,FechaReingreso - FechaCreacion as DiasCreacionCurseCorridos
	,FirmadelComprador_Inicio - FechaReingreso as DiasCurseFirmaCorridos
	,FirmadelComprador_Inicio - FechaCreacion as DiasCreacionFirmaCorridos
	,If(IsNum(FechaInicioProntoPago), 'Si', 'No') as InicioProntoPago;
LOAD
	*
	,if(TipoCarpeta = 'Asociada', 'A', 'P') & 
	 if(TipoCarpeta = 'Asociada', 
	 	Upper(left(CartaResguardo, 1))) &
	 if(TipoCarpeta = 'Asociada', '') &
	 if(MontoTope='Menor2000', 'ME', 'MA') as CodigosEstandar
	,monthname(if(TipoCarpeta='Asociada', FirmadelComprador_Inicio, FechaDesembolso)) as MesAñoFechaHitoFinal
	,if(TipoCarpeta='Asociada', FirmadelComprador_Inicio, FechaDesembolso) as FechaHitoFinal
	,if(TipoCarpeta='Asociada', FirmadelComprador_Inicio, FechaDesembolso) as FechaHitoFinal2
	,if(TipoCarpetaVCH='Asociada', FirmadelComprador_Inicio, FechaDesembolso) as FechaHitoFinalVCH
	,if(MarcaVendedorProntoPago = 'sin convenio', if(MarcaInmobiliariaProntoPago = 'con convenio', MarcaInmobiliariaProntoPago, MarcaVendedorProntoPago),MarcaVendedorProntoPago ) as MarcaProntoPagoConsolidada
	,if(TipoFinanciamientoProntoPago = 'Financiamiento Bech', if(IsNum(FirmadelComprador_Inicio), FirmadelComprador_Inicio, Null()),
		if(TipoFinanciamientoProntoPago = 'Financiamiento Otro Banco' or TipoFinanciamientoProntoPago = 'Recursos Propios', if(isnum(FirmadelVendedor_Inicio), FirmadelVendedor_Inicio, Null()), Null())) as FechaInicioProntoPago
	,GlosaEtapaActual/*)*/ as GlosaEtapaActual2
	,if(GlosaEtapaActual = 'Operación Desistida' , 'Desistida', 'Vigente') as VigenciaOperación;
LOAD
	*
	,If(isNull(ExcepcionProntoPago)	,if(wildmatch(GlosaProductoComercial, '*Pront*pag*')> 0,'producto ProntoPago', 'otro producto'), ExcepcionProntoPago) as TipoProductoProntoPago
    ,ApplyMap('Map_ExcepcionesProntoPagoFinanciamiento', NumeroSolicitud,   
	    If(WildMatch(GlosaProductoComercial, '*otros b*cos*') > 0, 'Financiamiento Otro Banco', 
	     	If(WildMatch(GlosaProductoComercial, '*Fin*Bech*') > 0, 'Financiamiento Bech', 
	     		If(Wildmatch(GlosaProductoComercial, '*Rec*Prop*')> 0, 'Recursos Propios', 'Otro Financiamiento')))) AS TipoFinanciamientoProntoPago,
	ApplyMap('Map_MarcaInmobiliaria', RutInmobiliaria, 'sin convenio') as MarcaInmobiliariaProntoPago,
	ApplyMap('Map_MarcaInmobiliaria', RutVendedor, 'sin convenio') as MarcaVendedorProntoPago,
	if(not IsNull(RutVendedor), RutVendedor, if(not IsNull(RutInmobiliaria), RutInmobiliaria, RutVendedor)) as RutConvenioProntoPago;

LOAD distinct 
	NumeroSolicitud, 
	NumeroSolicitud as NumeroSolicitud5,
	NumeroSolicitud as [N° VCH],
	Zona,
	OficinaNegocio as SUC_COD ,
	OficinaNegocio,
	NombreOficinaNegocio,
	NombreNegocio,
	Negocio,
	if(Zona<>'METRO' AND ApplyMap('Map_Fabrica', NombreAbogado, Null()) = 'Fábrica Externa', 'xx',
		if(OficinaNegocio='04' and FechaCreacion >'31-12-2007',
			ApplyMap('Map_NegocioOficina', NombreNegocio, Null()),
			OficinaNegocio)) as SUC_COD2,
 Traspasosupervisorasistentegestión_Inicio/*))*/ as FechaReingreso,
 Traspasosupervisorasistentegestión_Inicio/*)*/ as DiasCursePago,
	ApplyMap('Map_FechaFirmaBanco', NumeroSolicitud, 'Sin Fecha') as FechaFirmaBancoSUF,
	ApplyMap('Map_GrupoInmobiliario', Null()) as GrupoInmobiliariaProntoPagoMapeado,
	Subgerencia,
	Traspasosupervisorasistentegestión_Inicio,
	month(Traspasosupervisorasistentegestión_Inicio) as mesenvio,
	year(Traspasosupervisorasistentegestión_Inicio) as añoenvio,
	MonthName(Traspasosupervisorasistentegestión_Inicio) as AñoMesEmvioCurse,
	RutCliente,
	RutClienteDV,
	NombreCliente,
	ProductoOperativo,
	GlosaProductoComercial,
	CodigoProductoComercial,
	TipoCarpeta as TipoCarpetaVCH,
	RutVendedor,
	ApplyMap('Map_BaseNacional', RutVendedor, Null()) as TipoInmobiliarias2,
	if(RutVendedor >'50000000', 'Asociada','Particular') as TipoCarpetaporRutVend,
	DigitoVerificadorVendedor,
	NombreVendedor as NombreVendedorVCH,
	if(NombreAbogado='gestio90','Gestiona',NombreAbogado) as NombreAbogado,
	ApplyMap('Map_Fabrica', NombreAbogado, 'Fábrica Interna') as TipoFabrica,
	ApplyMap('Map_Fabrica2', NombreAbogado, 'Fábrica Interna') as TipoFabrica2,
	if(ApplyMap('Map_Fabrica', NombreAbogado, 'Fábrica Interna') = 'Fábrica Interna', 'Fábrica Interna',  if((NumeroPiloto & NumeroCarpeta <> ''), 'F. Externa Asociada','F. Externa Particular')) as TipoFabrica3,
	'Fábrica Hipotecaria' as TipoFabrica1,
	NombreInmobiliaria,
	NombreGarante,
	NumeroMutuo,
	FechaContabilizacion,
	FechaContabilizacion as FechaContabilizacionSemana,
	if(FechaContabilizacion>'0','Contabilizada','No Contabilizada') as Contabilización,
	MonthName(FechaContabilizacion) as AñoMesContabilización,
	ApplyMap('Map_FechaDesembolso', NumeroSolicitud, FechaDesembolso) as FechaDesembolso,
	ApplyMap('Map_FechaDesembolso', NumeroSolicitud, FechaDesembolso) as FechaPagoSemana,
	MonthName(FechaDesembolso) as AñoMesDesembolso,
	Pago_Inicio,
	Pago_Termino,
	NombreCurse as NombreCurse,
	NombreNotaria,
	Pagada,
	CodigoZona,
	NombreNotariaSUF,
	MontoTotal,
	FechaCreacion,
	year(FechaCreacion) as AñoCreacion,
	month(FechaCreacion) as MesCreacion,
	FechaPreAprobacion,
	FechaAprobacion,
	Aprobada,
	AñoContabilizacion,
	AñoDesembolso,
	AñoPreAprobacion,
	CiudadPropiedad,
	CodigoCBR,
	CodigoGarante,
	CodigoGarante as CodigoGarante2,
	if(CodigoGarante='','NO','SI') as Garante,
	ApplyMap('Map_CartaResg', CodigoGarante, 'con carta de resguardo') as CartaResguardo,
	ComunaPropiedad,
	Contabilizada,
	DecretoSupremo,
	Destino,
	EstadoPropiedad,
	Formalizada,
	GlosaEtapaActual,	
	ApplyMap('Map_AreaEtapa', GlosaEtapaActual, null()) AS Area,
	ApplyMap('Map_OrdenEtapa', GlosaEtapaActual, null()) AS OrdenEtapas,
	ApplyMap('Map_ListaEtapa', GlosaEtapaActual, null()) AS ListaParaPago,
	if(wildmatch( GlosaProductoComercial, '*RECEP*')='1', 'Recepción Futura', 'Recepción Normal') as RecepcionFutura,
	if(wildmatch( GlosaProductoComercial, '*AGE*')='1' or NombreAbogado='Agencias' or GlosaEtapaActual='Operación Desistida' ,'Agencia', 'No Agencia') as OrigenProducto,
	if(wildmatch( Upper(GlosaProductoComercial), '*REF*')='1','Refinanciamiento', 'Financiamiento') as TipoFinanciamiento,
	if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio') as TipoConvenio,
	if(RutVendedor >'50000000' and (if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio'))='Con Convenio' ,'Asociada','Particular') as TipoCarpeta,
	if(wildmatch( Upper(GlosaProductoComercial), '*DE SUBV*')='1' 
	or wildmatch( Upper(GlosaProductoComercial), '*CON SUBV*')='1' 
	,'con subvencion', 'sin subvencion') as TipoSubvencion,
	ApplyMap('Map_ExcepcionesProntoPago', NumeroSolicitud, Null()) as ExcepcionProntoPago,
	Hipoteca,
	MesContabilizacion,
	MesDesembolso,
	MesPreAprobacion,
	MontoSolicitadoPesos,
	MontoSolicitadoUf,
	if(TipoCarpeta = 'Asociada',if(FirmadelComprador_Inicio < '$(FechaTope)', 'Menor2000', if(MontoTotal <= $(valorUFTope), 'Menor2000', 'Mayor2000')),if(FechaDesembolso < '$(FechaTope)','Menor2000', if(MontoTotal <= $(valorUFTope), 'Menor2000', 'Mayor2000'))) as MontoTope,
	NombreCBR,
	NombreOficina,
	NombreOficinaCurse,
	NotariaSUF,
	OficinaCurse,
	RegionPropiedad,
	RutInmobiliaria,
	DvInmobiliaria,
	Subsidio,
	Tipo,
	TipoPropiedad,
	ValorPropiedadPesos,
	ValorPropiedadUf,
	AsistentedeNegociosenviaOperacionaCurse_Inicio,
	AsistentedeNegociosenviaOperacionaCurse_Real,
	AsistentedeNegociosenviaOperacionaCurse_Real_corrido,
	AsistentedeNegociosenviaOperacionaCurse_Termino,
	BorradordeEscritura_Inicio,
	BorradordeEscritura_Real,
	BorradordeEscritura_Real_corrido,
	BorradordeEscritura_Termino,
	CierredeCopias_Inicio,
	if(CierredeCopias_Inicio>'0','Si','No') as InicioCierredeCopias,
	CierredeCopias_Real,
	CierredeCopias_Real_corrido,
	CierredeCopias_Termino,
	if(CierredeCopias_Termino>'0','Si','No') as TerminoCierredeCopias,
	ComitédeCrédito_Inicio,
	ComitédeCrédito_Real,
	ComitédeCrédito_Real_corrido,
	ComitédeCrédito_Termino,
	ConfeccióndeMatrizdeescritura_Inicio,
	ConfeccióndeMatrizdeescritura_Real,
	ConfeccióndeMatrizdeescritura_Real_corrido,
	ConfeccióndeMatrizdeescritura_Termino,
	Contabilización_Inicio,
	Contabilización_Real,
	Contabilización_Real_corrido,
	Contabilización_Termino,
	ControldeCrédito_Inicio,
	ControldeCrédito_Real,
	ControldeCrédito_Real_corrido,
	ControldeCrédito_Termino,
	ControldeCréditoContabilizar_Inicio,
	ControldeCréditoContabilizar_Real,
	ControldeCréditoContabilizar_Real_corrido,
	ControldeCréditoContabilizar_Termino,
	CálculodeCrédito_Inicio,
	CálculodeCrédito_Real,
	CálculodeCrédito_Real_corrido,
	CálculodeCrédito_Termino,
	EnvíaaAbogadoInformate_Inicio,
	EnvíaaAbogadoInformate_Real,
	EnvíaaAbogadoInformate_Real_corrido,
	EnvíaaAbogadoInformate_Termino,
	EstudiodeTítulo_Inicio,
	EstudiodeTítulo_Real,
	EstudiodeTítulo_Real_corrido,
	EstudiodeTítulo_Termino,
	MonthName(EstudiodeTítulo_Termino) as AñoMesTerminoEstudiodeTítulo,
	if(EstudiodeTítulo_Real_corrido>'15','Si','No') as  EstudioTitulosMayor15Dias,
	Finiquito_Inicio,	
	Finiquito_Real,
	Finiquito_Real_corrido,
	Finiquito_Termino,
	if(Finiquito_Termino>'0','con finiquito', 'sin finiquito') as Finiquito, 
	year(Finiquito_Termino) as AñoFiniquito,
	month(Finiquito_Termino) as MesFiniquito,
	if(Finiquito_Termino>'0','Con Finiquito','Sin Finiquito') as ConFiniquito,
	FirmadelComprador_Inicio,
	FirmadelComprador_Inicio as FirmadelComprador_InicioSemana,
	MonthName(FirmadelComprador_Inicio) as AñoMesFirmaComprador,
	if(FirmadelComprador_Inicio>'0','Si','No') as InicioFirmaComprador,
	FirmadelComprador_Real,
	FirmadelComprador_Real_corrido,
	FirmadelComprador_Termino,
	if(FirmadelComprador_Termino>'0','Si','No') as TerminoFirmaComprador,
	if(FirmadelComprador_Termino>'0','Si','No') as FirmaComprador,
	today(3)-FirmadelComprador_Termino as DíasCorridosFirmaCompradorFechaActual,
	FirmadelVendedor_Inicio,
	if(FirmadelVendedor_Inicio>'0','Si','No') as InicioFirmaVendedor,
	FirmadelVendedor_Real,
	FirmadelVendedor_Real_corrido,
	FirmadelVendedor_Termino,
	MonthName(FirmadelVendedor_Termino) as AñoMesFirmaVendedorTermino,
	if(FirmadelVendedor_Termino>'0','Si','No') as TerminoFirmaVendedor,
	if(FirmadelVendedor_Termino>'0','Si','No') as FirmaVendedor,
	FirmadelVendedor_Termino-FirmadelComprador_Inicio as TiempoFirmaCompradorVendedorCorrido,
	FirmadelVendedor_Termino-FirmadelComprador_Termino as TiempoFirmaCompradorVendedorCorrido2,
	if(FirmadelVendedor_Termino-FirmadelComprador_Inicio<0,'SI','NO') as VendedorAntesComprador,
	InformadeFirmadePartes_Inicio,
	InformadeFirmadePartes_Real,
	InformadeFirmadePartes_Real_corrido,
	InformadeFirmadePartes_Termino,
	InscripciónenCBR_Inicio,
	if(InscripciónenCBR_Inicio>'0','Si','No') as InicioCBR,
	InscripciónenCBR_Real,
	InscripciónenCBR_Real_corrido,
	InscripciónenCBR_Termino,
	if(InscripciónenCBR_Termino>'0','Si','No') as TérminoCBR,
	Pago_Real,
	Pago_Real_corrido,
	PreFiniquito_Inicio,
	PreFiniquito_Real,
	PreFiniquito_Real_corrido,
	PreFiniquito_Termino,
	ProvisióndefondosparaGastosoperacionales_Inicio,
	ProvisióndefondosparaGastosoperacionales_Real,
	ProvisióndefondosparaGastosoperacionales_Real_corrido,
	ProvisióndefondosparaGastosoperacionales_Termino,
	RecibeSolicitud_Inicio,
	RecibeSolicitud_Real,
	RecibeSolicitud_Real_corrido,
	RecibeSolicitud_Termino,
	Revisióndeabogado_Inicio,
	Revisióndeabogado_Real,
	Revisióndeabogado_Real_corrido,
	Revisióndeabogado_Termino,
	SolicituddeCrédito_Inicio,
	SolicituddeCrédito_Real,
	SolicituddeCrédito_Real_corrido,
	SolicituddeCrédito_Termino,
	Tasación_Inicio,
	Tasación_Real,
	Tasación_Real_corrido,
	Tasación_Termino,
	TramitaciónCartadeResguardo_Inicio,
	TramitaciónCartadeResguardo_Real,
	TramitaciónCartadeResguardo_Real_corrido,
	TramitaciónCartadeResguardo_Termino,
	MonthName(TramitaciónCartadeResguardo_Termino) as AñoMesTramitaciónCartaResguardoTérmino,
	Traspasosupervisorasistentegestión_Real,
	Traspasosupervisorasistentegestión_Real_corrido,
	Traspasosupervisorasistentegestión_Termino,
	'' as VentadeLetras_Inicio,
	'' as VentadeLetras_Real,
	'' as VentadeLetras_Real_corrido,
	'' as VentadeLetras_Termino,
	VisadoComercial_Inicio,
	VisadoComercial_Real,
	VisadoComercial_Real_corrido,
	VisadoComercial_Termino,
	NumeroCarpeta,
	NumeroPiloto as NumeroPilotoVCH,
	if(NumeroPiloto='Solo Etapas',NumeroCarpeta,NumeroPiloto) as NumeroPiloto,
	if(RutVendedor >'50000000' and NumeroPiloto<>'' and NumeroCarpeta<>'','Asociada',
	if(RutVendedor <'50000000' and NumeroPiloto<>'' and NumeroCarpeta<>'','Asociada','Particular')) as TipoCarpetaAntiguo,	
	Tasa,
 	TasaVariable,
 	TipoDesistida,
 	OperaciónDesistida_Termino,
 	TasaFinal,
	FechaTasacion,
	if(FechaTasacion >'0','Si','No') as Tasacion,
	FechaEscrituracion,
	SAFE,
	Curse,
	Comision,
	Plazo,
	CodigoNotaria,
	PeriodoDeGracia,
	MesesSinVencimiento,
	RutEjecutivoInmobiliaria,
	TasaMaximaRenovacion,
	Serie,
	MontoComplementarioUf,
	Finalizada,
	NombreVendedor,
	IndicadorAbogado,
	NumeroOperacionComplementario,
 	if(Zona='METRO' and RutVendedor >'50000000', 'RM-Asociada',
	if(Zona='METRO' and RutVendedor <'50000000', 'RM-Particular',
	if(Zona='NORTE' and RutVendedor >'50000000', 'REGIONES-Asociada',
	if(Zona='NORTE' and RutVendedor <'50000000', 'REGIONES-Particular',
	if(Zona='SUR' and RutVendedor >'50000000', 'REGIONES-Asociada',
	if(Zona='SUR' and RutVendedor <'50000000', 'REGIONES-Particular')))))) as ZonaTipoCarpeta,
	if(Pagada='Si',(Pago_Termino-FechaCreacion)) as DiasCorridosCreacionPago,
	today(3)-FechaCreacion as DiasCorridosCreacionFechaActual,
	if(Pagada='Si'and (FechaDesembolso-FechaCreacion)< '91', 'Cumple', 
	if(Pagada='Si'and (FechaDesembolso-FechaCreacion)> '90','No Cumple',
	if(Pagada='No'and (today(3)-FechaCreacion)< '91','Cumple',
	if(Pagada='No'and (today(3)-FechaCreacion)> '90','No Cumple')))) as Cumple90Dias,
	if(GlosaEtapaActual='Traspaso supervisor - asistente gestión',Traspasosupervisorasistentegestión_Inicio,
	if(GlosaEtapaActual='Tasación',Tasación_Inicio,
	if(GlosaEtapaActual='Estudio de Título',EstudiodeTítulo_Inicio,
	if(GlosaEtapaActual='Cálculo de Crédito',CálculodeCrédito_Inicio,
	if(GlosaEtapaActual='Visado Comercial',VisadoComercial_Inicio,
	if(GlosaEtapaActual='Control de Crédito',ControldeCrédito_Inicio,
	if(GlosaEtapaActual='Envía a Abogado Informate',EnvíaaAbogadoInformate_Inicio,
	if(GlosaEtapaActual='Borrador de Escritura',BorradordeEscritura_Inicio,
	if(GlosaEtapaActual='Confección de Matriz de escritura',ConfeccióndeMatrizdeescritura_Inicio,
	if(GlosaEtapaActual='Firma del Comprador',FirmadelComprador_Inicio,
	if(GlosaEtapaActual='Control de Crédito (Contabilizar)',ControldeCréditoContabilizar_Inicio,
	if(GlosaEtapaActual='Contabilización',Contabilización_Inicio,
	if(GlosaEtapaActual='Firma del Vendedor',FirmadelVendedor_Inicio,
	if(GlosaEtapaActual='Informa de Firma de Partes',InformadeFirmadePartes_Inicio,
	if(GlosaEtapaActual='Tramitación Carta de Resguardo',TramitaciónCartadeResguardo_Inicio,
	if(GlosaEtapaActual='Revisión de abogado',Revisióndeabogado_Inicio,
	if(GlosaEtapaActual='PreFiniquito',PreFiniquito_Inicio,
	if(GlosaEtapaActual='Cierre de Copias',CierredeCopias_Inicio,
	if(GlosaEtapaActual='Inscripción en CBR',InscripciónenCBR_Inicio,
	if(GlosaEtapaActual='Finiquito',Finiquito_Inicio,
	if(GlosaEtapaActual='Pago',Pago_Inicio))))))))))))))))))))) as FechaInicioEtapaActual,
	if((isnull(PreFiniquito_Inicio) or PreFiniquito_Inicio='') and FechaDesembolso<Finiquito_Inicio ,FechaDesembolso,
		if((isnull(PreFiniquito_Inicio) or PreFiniquito_Inicio='') and FechaDesembolso>=Finiquito_Inicio,Finiquito_Inicio,
			PreFiniquito_Inicio)) as FechaLiberacionFondos, 
	if(wildmatch( GlosaProductoComercial, '*REF*')='1' and CodigoGarante='12', 'Refinanciamiento Interno',
	if(wildmatch( GlosaProductoComercial, '*REF*')='1' and CodigoGarante<>'12', 'Refinanciamiento Otras Instituciones',
	if(wildmatch( GlosaProductoComercial, '*REF*')='0' and (if(RutVendedor >'50000000' and (if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio'))='Con Convenio' ,'Asociada','Particular'))='Asociada' 
	and (if(CodigoGarante='' or CodigoGarante='-1' or CodigoGarante='0' or CodigoGarante='12','sin carta de resguardo','con carta de resguardo'))= 'con carta de resguardo', 'Asociada Con Carta de Resguardo',
	if(wildmatch( GlosaProductoComercial, '*REF*')='0' and (if(RutVendedor >'50000000' and (if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio'))='Con Convenio' ,'Asociada','Particular'))='Asociada' 
	and (if(CodigoGarante='' or CodigoGarante='-1' or CodigoGarante='0' or CodigoGarante='12','sin carta de resguardo','con carta de resguardo'))= 'sin carta de resguardo', 'Asociada Sin Carta de Resguardo',
	if(wildmatch( GlosaProductoComercial, '*REF*')='0' and (if(RutVendedor >'50000000' and (if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio'))='Con Convenio' ,'Asociada','Particular'))='Particular' 
	and (if(CodigoGarante='' or CodigoGarante='-1' or CodigoGarante='0' or CodigoGarante='12','sin carta de resguardo','con carta de resguardo'))= 'con carta de resguardo', 'Particular Con Carta de Resguardo',
	if(wildmatch( GlosaProductoComercial, '*REF*')='0' and (if(RutVendedor >'50000000' and (if(wildmatch( Upper(GlosaProductoComercial), '*CONV*')='1','Con Convenio', 'Sin Convenio'))='Con Convenio' ,'Asociada','Particular'))='Particular' 
	and (if(CodigoGarante='' or CodigoGarante='-1' or CodigoGarante='0' or CodigoGarante='12','sin carta de resguardo','con carta de resguardo'))= 'sin carta de resguardo', 'Particular Sin Carta de Resguardo')))))) as TipoSolicitud
	,FechaDesembolso-FechaCreacion as DiasCreacionPago
	,if(NumeroCarpeta='Solo Piloto' and Pagada='Si', Pagada, Null()) as PagadaPilotosPagados
	,if(NumeroCarpeta='Solo Piloto' and Pagada='Si', NumeroCarpeta, Null()) as NumeroCarpetaPilotosPagados
	,if((NumeroCarpeta='Solo Piloto' and Pagada='Si') or (Pagada='No'), NumeroPiloto, Null()) as NumeroPilotoPilotos
	,if(Pagada='No', Pagada, Null()) as SolicitudNoPagados
	,if(Pagada='No', GlosaEtapaActual, Null()) as GlosaEtapaActualNoPagados
FROM [Base QlikView2.TXT] (txt, utf8, embedded labels, delimiter is ';', no eof)
where isnum(NumeroSolicitud)  and FechaCreacion > '31-10-2007';
STORE NombreInmobiliaria, GrupoInmobiliariaProntoPagoMapeado  from VCH into Base Pprueba.txt (ansi, txt, delimiter is ';'); 
